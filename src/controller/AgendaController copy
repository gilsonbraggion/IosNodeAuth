const { authMiddleware } = require('../middleware/AuthIntercept');

// CRUD routes for customers
app.get("/customers", authMiddleware, async (req, res) => {
  try {
    const [customers] = await db.execute("SELECT * FROM customers");
    res.json(customers);
  } catch (error) {
    res.status(500).send("Error retrieving customers");
  }
});

app.post("/customers", authMiddleware, async (req, res) => {
  const { name, email } = req.body;
  try {
    await db.execute("INSERT INTO customers (name, email) VALUES (?, ?)", [name, email]);
    res.send("Customer added");
  } catch (error) {
    res.status(500).send("Error adding customer");
  }
});

app.put("/customers/:id", authMiddleware, async (req, res) => {
  const { name, email } = req.body;
  try {
    await db.execute("UPDATE customers SET name = ?, email = ? WHERE id = ?", [name, email, req.params.id]);
    res.send("Customer updated");
  } catch (error) {
    res.status(500).send("Error updating customer");
  }
});

app.delete("/customers/:id", authMiddleware, async (req, res) => {
  try {
    await db.execute("DELETE FROM customers WHERE id = ?", [req.params.id]);
    res.send("Customer deleted");
  } catch (error) {
    res.status(500).send("Error deleting customer");
  }
});